<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lista Ordenada ‚Äî estilo MAC</title>

  <!-- libs (opcionais: para exportar PDF/Excel se quiser) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    :root {
      --azul: #007BFF;
      --azul-escuro: #0056b3;
      --amarelo: #FFD700;
      --vermelho: #b22222;
      --muted-text: #757575;
      --bg: #fff;
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{font-family:monospace;margin:0;padding:0;color:#111;background:var(--bg)}

    /* ===== header ===== */
    header{display:flex;justify-content:space-between;align-items:center;background:var(--azul);color:white;padding:10px 14px;gap:12px;position:sticky;top:0;z-index:999}
    .menu-left,.menu-right{display:flex;gap:8px;align-items:center}
    .icon-btn{background:none;border:none;color:white;font-size:18px;cursor:pointer;padding:6px 8px;border-radius:6px}
    .icon-btn:hover{background:rgba(255,255,255,0.08)}

    /* dropdowns */
    .menu-dropdown{position:relative}
    .menu-dropdown-content{display:none;position:absolute;top:calc(100% + 6px);left:0;background:white;color:#111;border-radius:6px;box-shadow:0 6px 18px rgba(0,0,0,0.15);min-width:220px;max-width:calc(100vw - 40px);overflow:auto;overflow-x:hidden;z-index:1200;padding:6px 0;white-space:normal}
    .menu-right .menu-dropdown-content{right:0;left:auto}
    .menu-dropdown-content a{display:block;padding:8px 12px;color:#111;text-decoration:none;font-family:monospace}
    .menu-dropdown-content a:hover{background:#f2f2f2}
    .dropdown-section{border-top:1px solid #f0f0f0;padding-top:6px;margin-top:6px}
    .section-header{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:8px 12px;cursor:pointer;font-weight:700}
    .section-header small{font-weight:400;color:#666}
    .submenu{display:none;padding-left:6px;padding-bottom:6px}
    .submenu a{padding-left:18px;font-weight:500}

    /* ===== title with arrow ===== */
    .titulo-nav{display:flex;justify-content:center;align-items:center;gap:16px;margin:14px 10px 8px}
    .titulo-nav h1{margin:0;font-size:18px;color:#111}
    .titulo-nav .arrow{width:28px;height:28px;display:inline-flex;align-items:center;justify-content:center;border-radius:6px;cursor:pointer;color:var(--azul-escuro);text-decoration:none}
    .titulo-nav .arrow:hover{background:#f0f8ff}

    /* ===== container ===== */
    .container{display:flex;justify-content:center;gap:48px;align-items:flex-start;padding:10px 14px 24px;flex-wrap:wrap}
    .column{display:flex;flex-direction:column;gap:6px;min-width:300px;max-width:520px;width:100%}

    label{font-weight:700}

    textarea{width:100%;height:420px;padding:14px;font-size:15px;resize:none;border:1px solid #ddd;border-radius:8px;background:var(--bg);color:var(--muted-text);font-family:inherit;line-height:1.4}
    textarea[readonly]{background:#fafafa}
    textarea:focus{outline:none;border-color:var(--azul-escuro);box-shadow:0 0 0 4px rgba(0,123,255,0.08)}

    /* middle controls (apenas o bot√£o principal, igual MAC) */
    #middle-controls{display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:center;min-width:170px}
    #middle-controls button{width:170px;padding:10px 12px;font-size:14px;border-radius:6px;border:none;cursor:pointer;background:var(--azul);color:white}
    #middle-controls button:hover{filter:brightness(.95)}

    #copy-notice{position:fixed;right:18px;bottom:18px;background:rgba(0,0,0,0.78);color:white;padding:8px 12px;border-radius:6px;display:none;z-index:2000;font-family:monospace;font-size:13px}

    @media(max-width:900px){.container{gap:20px;padding:10px}}
    @media(max-width:520px){.container{flex-direction:column;align-items:center}#middle-controls{flex-direction:row}#middle-controls button{width:120px}}
  </style>
</head>
<body>

<header>
  <div class="menu-left">
    <div class="menu-dropdown">
      <button class="icon-btn" id="btn-hamburger" title="Menu" onclick="toggleMenu('dropdown-menu')">‚ò∞</button>

      <div class="menu-dropdown-content" id="dropdown-menu" role="menu" aria-hidden="true">
        <div class="dropdown-section">
          <div class="section-header" tabindex="0" onclick="toggleSubmenu(this)" onkeydown="if(event.key==='Enter') toggleSubmenu(this)">
            <span>MACS</span>
            <small class="chev">‚ñ∏</small>
          </div>
          <div class="submenu">
            <a href="#" data-mac="77" onclick="abrirMac(event, 'MAC Bairro S√£o Geraldo - C√≥d. 77')">MAC Bairro S√£o Geraldo - C√≥d. 77</a>
            <a href="#" data-mac="78" onclick="abrirMac(event, 'MAC Bairro Planalto - C√≥d. 78')">MAC Bairro Planalto - C√≥d. 78</a>
            <a href="#" data-mac="79" onclick="abrirMac(event, 'MAC Romeu Duarte - C√≥d. 79')">MAC Romeu Duarte - C√≥d. 79</a>
            <a href="#" data-mac="80" onclick="abrirMac(event, 'MAC Rua S√£o Geraldo / Centro 2 - C√≥d. 80')">MAC Rua S√£o Geraldo / Centro 2 - C√≥d. 80</a>
            <a href="#" data-mac="277" onclick="abrirMac(event, 'MAC Matriz - C√≥d. 277')">MAC Matriz - C√≥d. 277</a>
            <a href="#" data-mac="853" onclick="abrirMac(event, 'MAC Concesso - C√≥d. 853')">MAC Concesso - C√≥d. 853</a>
            <a href="#" data-mac="1249" onclick="abrirMac(event, 'MAC Jardim do Lago - C√≥d. 1249')">MAC Jardim do Lago - C√≥d. 1249</a>
            <a href="#" data-mac="989" onclick="abrirMac(event, 'MAC Ara√∫jos - C√≥d. 989')">MAC Ara√∫jos - C√≥d. 989</a>
          </div>
        </div>

        <div class="dropdown-section">
          <div class="section-header" tabindex="0" onclick="toggleSubmenu(this)" onkeydown="if(event.key==='Enter') toggleSubmenu(this)">
            <span>S√£o Jos√©</span>
            <small class="chev">‚ñ∏</small>
          </div>
          <div class="submenu">
            <a href="#" onclick="abrirLocal(event, 'S√£o Jos√©')">S√£o Jos√©</a>
            <a href="#" onclick="abrirLocal(event, 'P√£o Total')">P√£o Total</a>
          </div>
        </div>
      </div>
    </div>

    <!-- X (fechar) ‚Äî sem confirm -->
    <button class="icon-btn" id="btn-close" title="Fechar" onclick="fecharPagina()">‚ùå</button>

    <!-- Home ‚Äî placeholder -->
    <button class="icon-btn" id="btn-home" title="Menu inicial" onclick="voltarMenu()">üè†</button>
  </div>

  <div class="menu-right">
    <div class="menu-dropdown" style="position:relative">
      <button class="icon-btn" id="btn-save" title="Salvar" onclick="toggleMenu('dropdown-save')">üíæ</button>
      <div class="menu-dropdown-content" id="dropdown-save" aria-labelledby="btn-save">
        <a href="#" onclick="salvarComoTXT(event)" title="Salvar como TXT">Salvar como TXT</a>
        <a href="#" onclick="salvarComoPDF(event)" title="Salvar como PDF">Salvar como PDF</a>
        <a href="#" onclick="salvarComoExcel(event)" title="Salvar como Excel">Salvar como Excel</a>
      </div>
    </div>

    <button class="icon-btn" id="btn-print" title="Imprimir">üñ®Ô∏è</button>
    <button class="icon-btn" id="btn-copy" title="Copiar" onclick="copiarSaida()">üìã</button>
  </div>
</header>

<div class="titulo-nav" role="navigation" aria-label="Navega√ß√£o">
  <span style="width:28px;display:inline-block"></span>
  <h1 id="titulo-principal">Lista Ordenada</h1>
  <a href="#" class="arrow" id="arrow-right" title="Pr√≥ximo" onclick="navegarProximo()">‚Üí</a>
</div>

<div class="container">
  <div class="column">
    <label for="entrada"><strong>Texto de Entrada</strong></label>
    <textarea id="entrada" placeholder="Ex:
2 pacotes de leite
1 pct de caf√©
8 queijo" aria-label="Texto de entrada"></textarea>
  </div>

  <div id="middle-controls">
    <button id="btn-process" title="Processar" onclick="processar()" aria-label="Processar">‚Üí</button>
  </div>

  <div class="column">
    <label for="saida"><strong>Resultado (<span id="linhaQtd">0</span> linha)</strong></label>
    <textarea id="saida" readonly aria-label="Resultado ordenado"></textarea>
  </div>
</div>

  <div id="middle-controls">
    <button id="btn-process" title="Processar" onclick="processar()" aria-label="Processar">‚Üí</button>
    <button class="small-btn btn-amarelo" onclick="removerLinhasVazias()">Remover vazios</button>
    <button class="small-btn btn-vermelho" onclick="resetarTudo()">Resetar</button>
  </div>

  <div class="column">
    <label for="saida"><strong>Resultado (<span id="linhaQtd">0</span> linha)</strong></label>
    <textarea id="saida" readonly aria-label="Resultado ordenado"></textarea>
  </div>
</div>





<div id="copy-notice">Copiado!</div>

<script>
/* ============================
   Fun√ß√µes principais (mantive a l√≥gica do seu primeiro script)
   ============================ */

function removerAcentos(str){
  if (!str) return '';
  // usa Unicode property escapes (moderno) para remover diacr√≠ticos
  try {
    return str.normalize('NFD').replace(/\p{Diacritic}/gu, '');
  } catch(e){
    // fallback simples
    return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
  }
}

function pluralLinha(count){
  // voc√™ pediu que 0 tamb√©m mostre "linha" ‚Äî mantive isso.
  if (count === 1 || count === 0) return 'linha';
  return 'linhas';
}

function processar(){
  const texto = document.getElementById('entrada').value.trim();
  const saidaEl = document.getElementById('saida');
  const contadorEl = document.getElementById('linhaQtd');

  if (!texto){
    saidaEl.value = '';
    contadorEl.textContent = '0';
    atualizarContagemDireita(0);
    return;
  }

  const linhas = texto.split('\n').map(l=>l.trim()).filter(l=>l.length>0);

  const removiveis = ['pct','pcts','pacote','pacotes','pacote de','pct de','pcts de'];

  const processadas = linhas.map(orig => {
    let linha = orig.toLowerCase().trim();

    // corre√ß√µes r√°pidas
    linha = linha.replace(/\bkibe\b/g,'quibe');

    // remove termos proibidos (palavra inteira)
    removiveis.forEach(pal => {
      const regex = new RegExp('\\b'+pal+'\\b','gi');
      linha = linha.replace(regex,'').replace(/\s{2,}/g,' ').trim();
    });

    // move n√∫mero do in√≠cio para o fim se existir
    const partes = linha.split(/\s+/);
    const primeiro = partes[0];
    const resto = partes.slice(1).join(' ');
    if (primeiro !== undefined && primeiro !== '' && !isNaN(primeiro)){
      return (`${resto} ${primeiro}`).trim();
    }

    return linha;
  }).filter(Boolean);

  // ordena ignorando acentos
  const ordenadas = processadas.sort((a,b)=>{
    return removerAcentos(a).localeCompare(removerAcentos(b), 'pt', {sensitivity:'base'});
  });

  saidaEl.value = ordenadas.join('\n');
  contadorEl.textContent = ordenadas.length;
  atualizarContagemDireita(ordenadas.length);
}

function atualizarContagemDireita(qtd){
  const el = document.getElementById('contador-linhas');
  const span = document.getElementById('linhaQtd');
  if (!span) return;
  span.textContent = qtd;
  // pluraliza√ß√£o conforme pedido
  const label = `${qtd} ${pluralLinha(qtd)}`;
  el.innerText = `Linhas preenchidas: ${label}`;
}

function resetarTudo(){
  document.getElementById('entrada').value = '';
  document.getElementById('saida').value = '';
  atualizarContagemDireita(0);
}

function removerLinhasVazias(){
  const s = document.getElementById('saida');
  const linhas = s.value.split('\n').filter(l=>l.trim()!=='');
  s.value = linhas.join('\n');
  atualizarContagemDireita(linhas.length);
}

/* ============================
   Copiar / salvar / toasts
   ============================ */
function showBottomNotice(message='Copiado!', duration=2000){
  const el = document.getElementById('copy-notice');
  if (!el) return;
  if (el._hideTimeout) clearTimeout(el._hideTimeout);
  el.textContent = message; el.style.display = 'block';
  el._hideTimeout = setTimeout(()=>{el.style.display='none';el._hideTimeout=null}, duration);
}

function copiarSaida(){
  const out = document.getElementById('saida').value.trim();
  if (!out){ showBottomNotice('Nada para copiar',1500); return; }
  navigator.clipboard.writeText(out).then(()=> showBottomNotice('Copiado!',1200)).catch(()=>{
    // fallback
    const ta = document.createElement('textarea'); ta.value = out; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta);
    ta.select(); try{ document.execCommand('copy'); showBottomNotice('Copiado!',1200);}catch(e){ showBottomNotice('Falha ao copiar',1500);} ta.remove();
  });
}

function salvarComoTXT(e){ if(e) e.preventDefault(); const out = document.getElementById('saida').value.trim(); if(!out){showBottomNotice('Nada para salvar',1500); return;} baixarArquivo(out, 'lista_ordenada.txt', 'text/plain'); showBottomNotice('TXT salvo',1200); }

function salvarComoPDF(e){ if(e) e.preventDefault(); const out = document.getElementById('saida').value.trim(); if(!out){showBottomNotice('Nada para salvar em PDF',1500); return;} try{ const { jsPDF } = window.jspdf; const doc = new jsPDF({unit:'pt',format:'a4'}); doc.setFont('courier'); doc.setFontSize(11); const linhas = out.split('\n'); let y = 40; const margin = 40; linhas.forEach(l=>{ doc.text(l, margin, y, {maxWidth: doc.internal.pageSize.getWidth()-margin*2}); y+=14; if(y>doc.internal.pageSize.getHeight()-60){doc.addPage(); y=40;} }); doc.save('lista_ordenada.pdf'); showBottomNotice('PDF salvo',1200);}catch(err){ console.error(err); showBottomNotice('Erro ao gerar PDF',2000);} }

function salvarComoExcel(e){ if(e) e.preventDefault(); const out = document.getElementById('saida').value.trim(); if(!out){showBottomNotice('Nada para exportar',1500); return;} try{ const linhas = out.split('\n').map(r=>[r]); const wb = XLSX.utils.book_new(); const ws = XLSX.utils.aoa_to_sheet([['Resultado'], ...linhas]); XLSX.utils.book_append_sheet(wb, ws, 'Lista'); XLSX.writeFile(wb, 'lista_ordenada.xlsx'); showBottomNotice('Excel salvo',1200);}catch(err){ console.error(err); showBottomNotice('Erro ao exportar Excel',2000);} }

function baixarArquivo(conteudo, nomeArquivo, tipo){ const blob = new Blob([conteudo], {type: tipo}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = nomeArquivo; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(a.href),60000); }

/* ============================
   util UI / menus
   ============================ */
function toggleMenu(id){ document.querySelectorAll('.menu-dropdown-content').forEach(el=>{ if(el.id!==id){ el.style.display='none'; el.setAttribute('aria-hidden','true')} }); const el = document.getElementById(id); if(!el) return; if(el.style.display==='block'){ el.style.display='none'; el.setAttribute('aria-hidden','true'); } else { el.style.display='block'; el.setAttribute('aria-hidden','false'); }
}

document.addEventListener('click', (ev)=>{ if(!ev.target.closest('.menu-dropdown')){ document.querySelectorAll('.menu-dropdown-content').forEach(el=>{ el.style.display='none'; el.setAttribute('aria-hidden','true'); }); } });

function fecharPagina(){ try{ window.close(); }catch(e){} }
function navegarProximo(){ /* placeholder */ }

/* imprimir (vers√£o simples: gera PDF e abre em nova aba se poss√≠vel) */
function imprimirDireto(){ const out = document.getElementById('saida').value.trim(); if(!out){ showBottomNotice('Nada para imprimir',1500); return; } try{ const { jsPDF } = window.jspdf; const doc = new jsPDF({unit:'pt',format:'a4'}); doc.setFont('courier'); doc.setFontSize(11); const linhas = out.split('\n'); let y=40; const margin=40; linhas.forEach(l=>{ doc.text(l, margin, y, {maxWidth:doc.internal.pageSize.getWidth()-margin*2}); y+=14; if(y>doc.internal.pageSize.getHeight()-60){doc.addPage(); y=40;} }); const blob = doc.output('blob'); const url = URL.createObjectURL(blob); const newWin = window.open('', '_blank'); if(!newWin){ doc.save('lista_ordenada.pdf'); showBottomNotice('PDF baixado',1200); return; } try{ newWin.location.href = url; }catch(e){ newWin.document.open(); newWin.document.write(`<html><body style="margin:0"><embed src="${url}" type="application/pdf" width="100%" height="100%"/></body></html>`); newWin.document.close(); } setTimeout(()=>{ try{ URL.revokeObjectURL(url);}catch(e){} },60000); showBottomNotice('A abrir PDF',1200);}catch(err){ console.error(err); showBottomNotice('Erro ao imprimir',2000);} }

// attach print handler safely
const printBtn = document.getElementById('btn-print'); if(printBtn){ try{ printBtn.onclick = null; }catch(e){} printBtn.addEventListener('click', (ev)=>{ ev.preventDefault(); if(printBtn.disabled) return; printBtn.disabled = true; imprimirDireto(); setTimeout(()=>{printBtn.disabled=false}, 900); }); }

/* inicializa√ß√£o: atualiza contador com 0 e adiciona escuta Enter+Ctrl para processar */
document.addEventListener('DOMContentLoaded', ()=>{ atualizarContagemDireita(0); const entrada = document.getElementById('entrada'); if(entrada){ entrada.addEventListener('keydown', (ev)=>{ if((ev.ctrlKey||ev.metaKey) && ev.key==='Enter'){ processar(); } }); }
});

</script>
</body>
</html>
